(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4b9db9de"],{a888:function(e,t,a){"use strict";a("a481"),a("6762"),a("2fdb");var i={bind:function(e,t,a){var i=e.querySelector(".el-dialog__header"),s=e.querySelector(".el-dialog");i.style.cssText+=";cursor:move;",s.style.cssText+=";top:0px;";var r=function(){return window.document.currentStyle?function(e,t){return e.currentStyle[t]}:function(e,t){return getComputedStyle(e,!1)[t]}}();i.onmousedown=function(e){var t=e.clientX-i.offsetLeft,o=e.clientY-i.offsetTop,n=s.offsetWidth,l=s.offsetHeight,c=document.body.clientWidth,d=document.body.clientHeight,m=s.offsetLeft,u=c-s.offsetLeft-n,f=s.offsetTop,g=d-s.offsetTop-l,h=r(s,"left"),p=r(s,"top");h.includes("%")?(h=+document.body.clientWidth*(+h.replace(/\%/g,"")/100),p=+document.body.clientHeight*(+p.replace(/\%/g,"")/100)):(h=+h.replace(/\px/g,""),p=+p.replace(/\px/g,"")),document.onmousemove=function(e){var i=e.clientX-t,r=e.clientY-o;-i>m?i=-m:i>u&&(i=u),-r>f?r=-f:r>g&&(r=g),s.style.cssText+=";left:".concat(i+h,"px;top:").concat(r+p,"px;"),a.child.$emit("dragDialog")},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null}}}},s=function(e){e.directive("el-drag-dialog",i)};window.Vue&&(window["el-drag-dialog"]=i,Vue.use(s)),i.install=s;t["a"]=i},ac55:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-container",[a("el-header",{staticClass:"content-header",attrs:{height:"auto"}},[a("div",{staticClass:"content-header-left"},[a("el-button-group",[a("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.handleCreated}},[e._v("新增")])],1)],1),e._v(" "),a("div",{staticClass:"content-header-right"},[a("div",[a("el-select",{staticStyle:{width:"100px","margin-right":"10px"},attrs:{placeholder:"请选择"},on:{change:e.handleStateChange},model:{value:e.requestParams.state,callback:function(t){e.$set(e.requestParams,"state",t)},expression:"requestParams.state"}},e._l(e.stateOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),a("div",[a("el-input",{attrs:{clearable:"",placeholder:"请输入关键字"},on:{change:e.handleSearch},model:{value:e.requestParams.searchKey,callback:function(t){e.$set(e.requestParams,"searchKey",t)},expression:"requestParams.searchKey"}},[a("i",{staticClass:"el-icon-search el-input__icon content-header-search",attrs:{slot:"suffix"},on:{click:e.handleSearch},slot:"suffix"})])],1)])]),e._v(" "),a("el-main",{staticClass:"content-main"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableParams.tableLoading,expression:"tableParams.tableLoading"}],attrs:{"row-key":"rowIdx",height:e.tableParams.tableHeight,data:e.tableParams.tableData,border:"","highlight-current-row":""}},[a("el-table-column",{attrs:{prop:"rowIdx","column-key":"rowIdx",label:"序号",width:"50",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"rolename","column-key":"rolename",label:"角色名称",width:"180",align:"left","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"remark","column-key":"remark",label:"角色说明","min-width":"180",align:"left","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"state","column-key":"state",label:"状态",width:"90",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":0,"inactive-value":1},on:{change:function(t){return e.handleSwitchChange(i)}},model:{value:i.state,callback:function(t){e.$set(i,"state",t)},expression:"row.state"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createdtime","column-key":"createdtime",label:"创建时间",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row;return[a("i",{staticClass:"el-icon-time"}),e._v(" "),a("span",[e._v(e._s(i.createdtime))])]}}])}),e._v(" "),a("el-table-column",{attrs:{"column-key":"key",label:"操作",width:"100",align:"center",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{padding:"0px","margin-left":"2px"},attrs:{icon:"el-icon-edit",type:"text"},on:{click:function(a){return e.handleModify(t.row)}}}),e._v(" "),a("el-button",{staticStyle:{padding:"0px","margin-left":"2px"},attrs:{icon:"el-icon-key",type:"text"},on:{click:function(a){return e.handleModifyPolicies(t.row)}}}),e._v(" "),a("el-button",{staticStyle:{padding:"0px","margin-left":"2px"},attrs:{icon:"el-icon-delete",type:"text"},on:{click:function(a){return e.handleDeleted(t.row)}}})]}}])})],1)],1),e._v(" "),a("el-footer",{staticClass:"content-footer",attrs:{height:"auto"}},[a("el-pagination",{attrs:{"current-page":e.requestParams.pageIndex,"page-size":e.requestParams.pageSize,total:e.tableParams.total,"page-sizes":e.tableParams.pageSizeOptions,layout:e.tableParams.layoutOptions},on:{"update:currentPage":function(t){return e.$set(e.requestParams,"pageIndex",t)},"update:current-page":function(t){return e.$set(e.requestParams,"pageIndex",t)},"update:pageSize":function(t){return e.$set(e.requestParams,"pageSize",t)},"update:page-size":function(t){return e.$set(e.requestParams,"pageSize",t)},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"prev-click":e.handleCurrentChange,"next-click":e.handleCurrentChange}})],1)],1),e._v(" "),a("el-drawer",{attrs:{size:"320px","custom-class":"el-drawer-custom-class","destroy-on-close":"",title:e.editParams.drawerTitle,visible:e.editParams.drawerVisible},on:{"update:visible":function(t){return e.$set(e.editParams,"drawerVisible",t)}}},[a("div",{staticStyle:{display:"flex","flex-direction":"column",height:"100%",padding:"0px 20px"}},[a("div",{staticStyle:{flex:"1"}},[a("el-form",{ref:"roleForm",attrs:{model:e.editParams.form,rules:e.editParams.rules}},[a("el-form-item",{attrs:{label:"角色名称：",prop:"rolename","label-width":e.editParams.formLabelWidth}},[a("el-input",{attrs:{placeholder:"请输入角色名称",autocomplete:"off"},model:{value:e.editParams.form.rolename,callback:function(t){e.$set(e.editParams.form,"rolename",t)},expression:"editParams.form.rolename"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色描述：",prop:"remark","label-width":e.editParams.formLabelWidth}},[a("el-input",{attrs:{placeholder:"请输入角色描述",autocomplete:"off"},model:{value:e.editParams.form.remark,callback:function(t){e.$set(e.editParams.form,"remark",t)},expression:"editParams.form.remark"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"状态：",prop:"state","label-width":e.editParams.formLabelWidth}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":0,"inactive-value":1},model:{value:e.editParams.form.state,callback:function(t){e.$set(e.editParams.form,"state",t)},expression:"editParams.form.state"}})],1)],1)],1),e._v(" "),a("div",{staticStyle:{display:"flex",padding:"10px 0"}},[a("el-button",{staticStyle:{flex:"1"},on:{click:function(t){e.editParams.drawerVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{staticStyle:{flex:"1"},attrs:{type:"primary",loading:e.editParams.submitLoading},on:{click:e.handleSave}},[e._v(e._s(e.editParams.submitLoading?"提交中...":"确 定"))])],1)])]),e._v(" "),a("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{width:"620px","custom-class":"el-dialog-custom-class","destroy-on-close":"",title:e.modifyPoliciesParams.dialogTitle,visible:e.modifyPoliciesParams.dialogVisible},on:{"update:visible":function(t){return e.$set(e.modifyPoliciesParams,"dialogVisible",t)}}},[a("div",{staticStyle:{display:"flex","flex-direction":"column",height:"100%"}},[a("div",{staticStyle:{flex:"1"}},[a("el-transfer",{directives:[{name:"loading",rawName:"v-loading",value:e.modifyPoliciesParams.initLoading,expression:"modifyPoliciesParams.initLoading"}],attrs:{titles:["前台用户列表","角色用户列表"],props:e.modifyPoliciesParams.transferProps,data:e.modifyPoliciesParams.transferData},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.option;return a("span",{},[e._v(e._s(i.nickname)+" - "+e._s(i.username))])}}]),model:{value:e.modifyPoliciesParams.selectedData,callback:function(t){e.$set(e.modifyPoliciesParams,"selectedData",t)},expression:"modifyPoliciesParams.selectedData"}},[e._v(" "),a("el-button",{staticClass:"transfer-footer",staticStyle:{flex:"1",margin:"3px 0 3px 5px",padding:"8px"},attrs:{slot:"right-footer",type:"primary",loading:e.modifyPoliciesParams.submitLoading},on:{click:e.handleSavePolicies},slot:"right-footer"},[e._v(e._s(e.modifyPoliciesParams.submitLoading?"提交中...":"确 定"))])],1)],1)])])],1)},s=[],r=(a("ac6a"),a("8593")),o=a("a888"),n={name:"UserRole",filters:{},components:{},directives:{"el-drag-dialog":o["a"]},props:{},data:function(){return{screenHeight:0,stateOptions:[{value:-1,label:"全部"},{value:0,label:"启用"},{value:1,label:"禁用"}],requestParams:{pageIndex:1,pageSize:10,orderby:"",sort:0,searchKey:"",state:-1},tableParams:{tableLoading:!1,tableHeight:0,tableColumns:[],tableData:[],total:0,layoutOptions:"total, sizes, prev, pager, next, jumper",pageSizeOptions:["10","20","30","50","100","200"],multipleSelection:[]},editParams:{isModify:!1,drawerVisible:!1,drawerTitle:"提示",submitLoading:!1,formLabelWidth:"100px",form:{id:"",rolename:"",remark:"",state:0},rules:{rolename:[{required:!0,message:"角色名称不为空",trigger:"blur"}],remark:[{required:!0,message:"角色描述不为空",trigger:"blur"}],state:[{type:"number",message:"状态不合法",trigger:"blur"}]}},modifyPoliciesParams:{dialogVisible:!1,dialogTitle:"分配用户",submitLoading:!1,initLoading:!1,transferProps:{key:"id",label:"nickname"},transferData:[],selectedData:[],roleid:""}}},computed:{},watch:{},created:function(){},mounted:function(){var e=this;this.$nextTick((function(t){return e.initPage()}));var t=null;window.onresize=function(a){return function(a){t&&(clearTimeout(t),t=null),t=setTimeout((function(t){return e.setPageHeight()}),500)}()}},methods:{initPage:function(){this.setPageHeight(),this.getTableData()},setPageHeight:function(){this.screenHeight=document.body.clientHeight,this.tableParams.tableHeight=this.screenHeight-182},getTableColumns:function(){var e=this;this.tableParams.tableColumns=[{columnName:"rowIdx",columnLabel:"序号",columnWidth:58,align:"center",headerAlign:"center",sortable:!1,fixed:!0,show:!0},{columnName:"state",columnLabel:"状态",columnWidth:80,align:"center",headerAlign:"center",sortable:!1,fixed:!1,show:!0,formatter:function(t,a,i){var s=e.$createElement;return s("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":0,"inactive-value":1,value:i,rowid:t.id}})}}]},getSearchParam:function(){var e={};for(var t in this.requestParams)if(this.requestParams.hasOwnProperty(t)){var a=this.requestParams[t];a instanceof Array?!a.length||1===a.length&&-1===a[0]||(e[t]=a):0!==a&&!a||-1===a||""!==a&&(e[t]=a)}return e},getTableData:function(){var e=this;this.tableParams.tableLoading=!0,Object(r["s"])(this.getSearchParam()).then((function(t){var a=[],i=(e.requestParams.pageIndex-1)*e.requestParams.pageSize;t.data.PageData.forEach((function(t,s){t["rowIdx"]=i+ ++s,t["createdtime"]=e.$moment(t["createdtime"]).format("YYYY-MM-DD HH:mm:ss"),a.push(t)})),e.tableParams.tableData=a,e.tableParams.total=t.data.TotalItems,e.tableParams.tableLoading=!1})).catch((function(t){e.$message.error({message:t.message||"请求出错"}),e.tableParams.tableLoading=!1}))},handleSizeChange:function(e){this.requestParams.pageIndex=1,this.requestParams.pageSize=e,this.getTableData()},handleCurrentChange:function(e){this.requestParams.pageIndex=e,this.getTableData()},handleStateChange:function(e){this.requestParams.pageIndex=1,this.getTableData()},handleSearch:function(e){this.requestParams.pageIndex=1,this.getTableData()},handleSwitchChange:function(e){var t=this;Object(r["U"])(e.id,0===e.state).catch((function(e){t.$message.error({message:e.message||"请求出错"}),t.getTableData()}))},handleCreated:function(){this.editParams.isModify=!1,this.editParams.drawerTitle="新增角色",this.editParams.drawerVisible=!0,this.editParams.form={id:"",rolename:"",remark:"",state:0}},handleModify:function(e){this.editParams.isModify=!0,this.editParams.drawerTitle="修改角色",this.editParams.drawerVisible=!0,this.editParams.form=JSON.parse(JSON.stringify(e))},handleSave:function(){var e=this;this.editParams.submitLoading=!0,this.$refs.roleForm.validate((function(t){if(!t)return e.editParams.submitLoading=!1,!1;Object(r["G"])(e.editParams.form,e.editParams.isModify).then((function(t){e.editParams.drawerVisible=!1,e.editParams.submitLoading=!1,e.getTableData()})).catch((function(t){e.$message.error({message:t.message||"请求出错"}),e.editParams.submitLoading=!1}))}))},handleModifyPolicies:function(e){var t=this;this.modifyPoliciesParams.dialogVisible=!0,this.modifyPoliciesParams.submitLoading=!1,this.modifyPoliciesParams.roleid=e.id,this.modifyPoliciesParams.initLoading=!0,Object(r["p"])(this.modifyPoliciesParams.roleid).then((function(e){t.modifyPoliciesParams.transferData=e.data;var a=[];t.modifyPoliciesParams.transferData.forEach((function(e){!0===e["isexist"]&&a.push(e.id)})),t.modifyPoliciesParams.selectedData=a,t.modifyPoliciesParams.initLoading=!1})).catch((function(e){t.$message.error({message:e.message||"请求出错"}),t.modifyPoliciesParams.initLoading=!1,t.modifyPoliciesParams.dialogVisible=!1}))},handleSavePolicies:function(){var e=this;this.modifyPoliciesParams.selectedData.length<1?this.$message.error({message:"请选择用户"}):(this.modifyPoliciesParams.submitLoading=!0,Object(r["H"])({roleid:this.modifyPoliciesParams.roleid,userids:this.modifyPoliciesParams.selectedData}).then((function(t){e.modifyPoliciesParams.dialogVisible=!1,e.modifyPoliciesParams.submitLoading=!1})).catch((function(t){e.$message.error({message:t.message||"请求出错"}),e.modifyPoliciesParams.submitLoading=!1})))},handleDeleted:function(e){var t=this;this.$confirm("此操作将永久删除角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(r["P"])([e.id]).then((function(e){return t.getTableData()})).catch((function(e){t.$message.error({message:e.message||"请求出错"})}))})).catch((function(){}))}}},l=n,c=a("2877"),d=Object(c["a"])(l,i,s,!1,null,"fced851e",null);t["default"]=d.exports}}]);